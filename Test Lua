-- AimLock by ArchScrim x ChatGPT - Compatible Xeno
-- Touche Q pour lock | Ctrl pour ouvrir/fermer le menu

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local player = Players.LocalPlayer
local mouse = player:GetMouse()

repeat wait() until player.Character and player:FindFirstChild("PlayerGui")

-- ✅ Notification de lancement
StarterGui:SetCore("SendNotification", {
	Title = "ArchScrim",
	Text = "Script lancé avec succès",
	Duration = 5
})

-- AimLock Variables
local aimlockEnabled = false
local aimKey = Enum.KeyCode.Q
local prediction = 0.06
local currentTarget = nil
local menuVisible = true

-- UI dans CoreGui (compatible Xeno)
local gui = Instance.new("ScreenGui")
gui.Name = "AimLockMenu"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.Parent = game:GetService("CoreGui")

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 280, 0, 160)
frame.Position = UDim2.new(0.5, -140, 0.5, -80)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 8)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundTransparency = 1
title.Text = "AimLock System"
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.GothamBold
title.TextSize = 18

local status = Instance.new("TextLabel", frame)
status.Position = UDim2.new(0, 0, 0, 40)
status.Size = UDim2.new(1, 0, 0, 30)
status.BackgroundTransparency = 1
status.Text = "Status: OFF (Q)"
status.TextColor3 = Color3.new(1, 1, 1)
status.Font = Enum.Font.Gotham
status.TextSize = 16

-- Toggle Menu (Ctrl)
UIS.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == Enum.KeyCode.LeftControl then
		menuVisible = not menuVisible
		frame.Visible = menuVisible
	end
end)

-- Toggle AimLock (Q)
UIS.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == aimKey then
		aimlockEnabled = not aimlockEnabled
		status.Text = "Status: " .. (aimlockEnabled and "ON" or "OFF") .. " (Q)"
		if not aimlockEnabled then currentTarget = nil end
	end
end)

-- Prédiction
local function getPrediction(part)
	if not part then return nil end
	return part.Position + (part.Velocity * prediction)
end

-- Trouver le joueur le plus proche du curseur
local function getClosestPlayer()
	local closestDist = math.huge
	local closestPlayer = nil

	for _, p in pairs(Players:GetPlayers()) do
		if p ~= player and p.Character and p.Character:FindFirstChild("Humanoid") and p.Character:FindFirstChild("HumanoidRootPart") then
			if p.Character.Humanoid.Health > 0 then
				local root = p.Character.HumanoidRootPart
				local screenPos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(root.Position)
				if onScreen then
					local dist = (Vector2.new(mouse.X, mouse.Y) - Vector2.new(screenPos.X, screenPos.Y)).Magnitude
					if dist < closestDist and dist < 250 then
						closestDist = dist
						closestPlayer = p
					end
				end
			end
		end
	end

	return closestPlayer
end

-- Main loop
RunService.RenderStepped:Connect(function()
	if aimlockEnabled then
		if not currentTarget or not currentTarget.Character or currentTarget.Character.Humanoid.Health <= 0 then
			currentTarget = getClosestPlayer()
		end

		if currentTarget and currentTarget.Character and currentTarget.Character:FindFirstChild("HumanoidRootPart") then
			local aimPart = currentTarget.Character:FindFirstChild("HumanoidRootPart")
			local pos = getPrediction(aimPart)
			if pos then
				workspace.CurrentCamera.CFrame = CFrame.new(workspace.CurrentCamera.CFrame.Position, pos)
			end
		end
	end
end)
